#!/usr/bin/env node

/* eslint-disable no-console */

const prompt = require('prompt');
const fs = require('fs');
const path = require('path');

const CONFIN_FILE_NAME = 'config.json';
const CONFIG_FILE_PATH = path.join(process.cwd(), CONFIN_FILE_NAME);

if (!fs.existsSync(CONFIG_FILE_PATH)) {
  fs.writeFileSync(CONFIG_FILE_PATH, '{}');
  console.log(`Created "${CONFIN_FILE_NAME}".`);
}

const config = JSON.parse(fs.readFileSync(CONFIG_FILE_PATH).toString());

const schema = {
  properties: {
    env: {
      description: 'rc / stage / dev**',
      message: 'Input rc, stage, dev*',
      required: true,
    },
  },
};

prompt.start();

prompt.get(schema, (err, { env }) => {
  if (err) {
    console.error(err);
    return;
  }

  const isLikeProd = ['rc', 'stage'].includes(env);

  const defaultConfig = {
    AIRSLATE_ENV_CONFIGURATION: {
      API_HOST: `api.airslate-${env}.xyz`,
      API_INTEGRATIONS_HOST: `https://integrations.airslate-${env}.xyz`,
      STATIC_URL: '//cdn.airslate.com/static/3089-prod',
      MAIN_DOMAIN: 'airslate.localhost',
      API_SUPPORT_HOST: isLikeProd ? `https://sb-${env}.pdffiller.com/support/airslate` : 'https://sb-dev.pdffiller.com/support/airslate',
      API_SUPERVISOR_SOCKET_HOST: isLikeProd ? `https://sv-${env}.pdffiller.com:8081` : 'https://sv-dev.pdffiller.com:8091',
      WS_HOST: isLikeProd ? `wss://message-manager-ws.airslate-${env}.xyz` : `wss://airslate-${env}.xyz:8046`,
      DOC_CREATOR_FRAME_URL: isLikeProd ? 'https://devapp.pdffiller.com/en/createnewform/airslate' : 'https://devapp.pdffiller.com',
      POLICY_URL: `//www.airslate-${env}.xyz/privacy-policy`,
      TERMS_URL: `//www.airslate-${env}.xyz/terms-of-service`,
      GOOGLE_RECAPTCHA_V2_SITE_KEY: '________',
      GOOGLE_RECAPTCHA_V3_SITE_KEY: '________',
      MARKETING_SKS_LINK: 'https://cdn.mr-dev.xyz/sks/js/sks_track.js',
    },
    AIRSLATE_TEMP_DATA: {},
  };

  const nextConfig = {
    ...config,
    ...defaultConfig,
  };

  fs.writeFileSync(CONFIG_FILE_PATH, JSON.stringify(nextConfig, null, 2));

  console.log();
  console.log(`Updated "${CONFIN_FILE_NAME}"`);
  console.log();
});
